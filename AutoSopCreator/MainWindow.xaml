<Window x:Class="AutoSopCreator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="酷意 AI SOP 產生器 V5_開源版" Height="700" Width="1000">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <GroupBox Header="AI 與 匯出設定" Grid.Row="0" Margin="0,0,0,10">
            <StackPanel>
                <DockPanel Margin="0,5">
                    <Label Content="API Key:" Width="80"/>
                    <PasswordBox x:Name="TxtApiKey" PasswordChanged="TxtApiKey_PasswordChanged"/>
                </DockPanel>
                <DockPanel Margin="0,5">
                    <Label Content="模型:" Width="80"/>
                    <ComboBox x:Name="ComboModel" IsEditable="True" SelectedIndex="0">
                        <ComboBoxItem Content="gemini-2.5-flash"/>
                        <ComboBoxItem Content="gemini-2.5-pro"/>
                    </ComboBox>
                </DockPanel>
                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <Label Content="匯出格式:" Width="80"/>
                    <RadioButton x:Name="RbHtml" Content="HTML (網頁)" GroupName="ExportFormat" IsChecked="True" Margin="5,0"/>
                    <RadioButton x:Name="RbWord" Content="Word (.docx)" GroupName="ExportFormat" Margin="5,0"/>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <ListView x:Name="StepListView" Grid.Row="1" Margin="0,5" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListView.ItemTemplate>
                <DataTemplate>
                    <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="5" Padding="5" Margin="0,5" Background="White">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Image Source="{Binding DisplayImage}" Grid.Column="0" Height="100" Stretch="Uniform"/>
                            <StackPanel Grid.Column="1" Margin="10,0">
                                <TextBlock Text="{Binding StepNumber, StringFormat='步驟 {0}'}" FontWeight="Bold" Foreground="#0078D7"/>
                                <TextBox Text="{Binding Description, Mode=TwoWay}" TextWrapping="Wrap" AcceptsReturn="True" Height="80" Margin="0,5,0,0" VerticalScrollBarVisibility="Auto"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                <Button Content="在此後插入" Margin="0,0,0,5" Padding="5,2" Background="#E0F7FA" Foreground="#006064" Click="BtnInsert_Click" Tag="{Binding}"/>
                                <Button Content="AI 重寫" Margin="0,0,0,5" Padding="5,2" Background="#FFF4CE" Click="BtnRegen_Click" Tag="{Binding}"/>
                                <Button Content="刪除步驟" Padding="5,2" Background="#FFE8E8" Foreground="Red" Click="BtnDelete_Click" Tag="{Binding}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <StackPanel Grid.Row="2" Orientation="Vertical" HorizontalAlignment="Center" Margin="0,10">
            <CheckBox x:Name="ChkHotkeyMode" Content="僅錄製精華 (需按住 Ctrl + Alt + 點擊)" IsChecked="True" Margin="0,0,0,10" HorizontalAlignment="Center"/>
            <StackPanel Orientation="Horizontal">
                <Button x:Name="BtnStart" Content="開始錄製" Width="100" Height="40" Margin="10" Click="BtnStart_Click" Background="#4CAF50" Foreground="White"/>
                <Button x:Name="BtnStop" Content="停止錄製 &amp; 分析" Width="120" Height="40" Margin="10" Click="BtnStop_Click" IsEnabled="False"/>
                <Button x:Name="BtnExport" Content="匯出文件" Width="100" Height="40" Margin="10" Click="BtnExport_Click" IsEnabled="False" Background="#0078D7" Foreground="White"/>
            </StackPanel>
        </StackPanel>
        
        <Label x:Name="StatusLabel" Content="準備就緒" Grid.Row="2" VerticalAlignment="Bottom" HorizontalAlignment="Left" FontSize="10" Foreground="Gray"/>
    </Grid>
</Window>